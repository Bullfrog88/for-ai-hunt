openapi: 3.0.0
info:
  title: User Registration API
  version: 1.0.0

paths:
  /api/v1/users/register:
    post:
      summary: Register new user
      description: Register a new user after validation and CAPTCHA verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - userName
                - password
                - captchaToken
              properties:
                firstName:
                  type: string
                  minLength: 1
                  maxLength: 50
                  pattern: "^[a-zA-Z\\s\\-']+$"
                lastName:
                  type: string
                  minLength: 1
                  maxLength: 50
                  pattern: "^[a-zA-Z\\s\\-']+$"
                userName:
                  type: string
                  minLength: 3
                  maxLength: 30
                  pattern: "^[a-zA-Z0-9_]+$"
                password:
                  type: string
                  minLength: 8
                  maxLength: 32
                  pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,32}$"
                captchaToken:
                  type: string
                  minLength: 1
        example:
          firstName: "John"
          lastName: "Doe"
          userName: "johndoe"
          password: "SecurePass123!"
          captchaToken: "03AOLTBLR5UtIoenazhjja8..."

      responses:
        '201':
          description: User successfully registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                    format: uuid
                  userName:
                    type: string
                  createdAt:
                    type: string
                    format: date-time
                  message:
                    type: string
              example:
                userId: "550e8400-e29b-41d4-a716-446655440000"
                userName: "johndoe"
                createdAt: "2024-01-15T10:30:00Z"
                message: "User registered successfully"

        '400':
          description: Bad request - invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "VALIDATION_ERROR"
                message: "Invalid input data"
                details:
                  field: "password"
                  violation: "Password must contain at least one special character"

        '409':
          description: Username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "USERNAME_EXISTS"
                message: "Username already exists"

        '422':
          description: CAPTCHA validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "CAPTCHA_FAILED"
                message: "CAPTCHA verification failed"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "INTERNAL_ERROR"
                message: "Internal server error"

components:
  schemas:
    ErrorResponse:
      type: object
      required:
        - errorCode
        - message
      properties:
        errorCode:
          type: string
        message:
          type: string
        details:
          type: object
          nullable: true
